<!DOCTYPE html>
<html>
<head>
    
    <script type="text/javascript" src="http://mbostock.github.com/d3/d3.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>

    </head>
<body>

    
<style type="text/css">
    svg {
        border: 1px solid #dddddd;
    }
     .overlay {
          fill: none;
          pointer-events: all;
        }

</style>

<script type="text/javascript">
    
    var svgPath = "CountyMap.svg";
    var width = 500;
    var height = 500;
      
    var  color = d3.scale.linear().domain([0,100,700]).range(['white', 'red',"rgb(140, 23, 40)"]).clamp(true);
   
    /* color = d3.scale.quantize()
        .domain([0,600])
        .range(d3.range(6).map(function(d) {return colorArray[d]; }));

    */
    d3.xml(svgPath, "image/svg+xml", function(xml) {
        document.body.appendChild(xml.documentElement);
        var svg = d3.select("svg");
        svg.select("g").call(d3.behavior.zoom().scaleExtent([1, 8]).on("zoom", zoom));     
        var map = svg.select("g");
    map.selectAll("path").attr("fill", function(){return "white";});
    
        function  foo(s)
        {
            var result="";
            s = s.split(" ");
            for(var a = 0; a< s.length ;a ++){
                result = result +format(s[a]) +"_";}
            if((result[0]+result[1])=="Mc"){
                result=result.substr(0,2)+result[2].toUpperCase()+result.substr(3,result.length);
                    
            }
            
            return result.substr(0,result.length-1);
                                         
        }
        
        function format(s)
        { return s.substr(0,1).toUpperCase()+s.substr(1,s.length).toLowerCase();}
        
        
        d3.json("heat.json", function(data) {
        
        data.forEach(function(d,i) {
            data[i]["County"]=foo(data[i]["County"]);
            for(var y=1997;y<=2013;y++)
            {
                data[i][y]=color(data[i][y]);
                
            }
                
        });
        
            
        var k=0;


        for(var year=1997;year<=2013;year++)
            {
           
        svg.selectAll("path").each(function(d,i){
            if(data[i])
            {    
                var z = data[i][year];
            svg.select("#"+data[i]["County"])
             .transition()
             .duration(100)
            .delay(1000*k)
            .style("fill", function(){
                
                return z;});
            
            svg.select("#"+data[i]["County"]).selectAll("path")
             .transition()
            .delay(1000*k)
             .duration(1000)
            .style("fill", function(d,i){
            
                return z;});
        
            }
        });
            k++;
    
            }
        
    });    
function zoom() {
      var svg = d3.select("svg").select("g");
  svg.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");

}
        
        
  });
    
    

</script>


</body>
</html>